{{- /*gotype: main.TemplateData*/ -}}
// Code generated by protoc-gen-fasthttp. DO NOT EDIT.
package {{.Package}}

import (
	"context"
	codes "google.golang.org/grpc/codes"
	status "google.golang.org/grpc/status"

	"github.com/fasthttp/router"
	"github.com/streamdealer/protoc-gen-fasthttp/pkg/http"
	"github.com/valyala/fasthttp"
)

type {{.ServerName}} interface {
	{{ range .RPCs }}
	{{.RPCName}}(context.Context, *{{.RequestType}}) (*{{.ResponseType}}, error)
	{{- end }}
}

type Unimplemented{{.ServerName}} struct{}

{{- range .RPCs }}
func (Unimplemented{{$.ServerName}}) {{.RPCName}}(context.Context, *{{.RequestType}}) (*{{.ResponseType}}, error) {
	return nil, status.Errorf(codes.Unimplemented, "method {{.RPCName}} not implemented")
}
{{- end }}

func Register{{.ServiceName}}Routes(r *router.Router, impl {{.ServerName}}) {
	{{- range .RPCs }}
	r.{{.HTTPVerb}}("{{.HTTPPath}}", {{.HandlerName}}(impl))
	{{- end }}
}

{{- range .RPCs }}
func {{.HandlerName}}(
	impl {{$.ServerName}},
) fasthttp.RequestHandler {
	return func(ctx *fasthttp.RequestCtx) {
		var req = &{{.RequestType}}{}

		http.ToProto(ctx, req)
		resp, err := impl.{{.RPCName}}(ctx, req)

		http.RespondWith(ctx, resp, err)
	}
}
{{ end }}
